# MySmartRoute

Αυτό το project είναι παράδειγμα εφαρμογής Android.
Προς το παρόν έχει απενεργοποιηθεί το Firebase App Check ώστε να μπορείτε να κάνετε είσοδο χωρίς επιπλέον έλεγχο.
Επιπλέον, η εγγραφή δεν απαιτεί πλέον επιβεβαίωση μέσω SMS.

Από την έκδοση 1.4 ο χάρτης έχει πλέον σταθερό ύψος και εμφανίζεται σωστά.
Από την έκδοση 1.7 το μενού επιλογών είναι πλέον έτοιμο.
Από την έκδοση 1.8 το μενού χρήστη υλοποιήθηκε με κληρονομικότητα.
Από την έκδοση 1.9 τα στοιχεία του UI ακολουθούν τα χρώματα του θέματος.

Από την έκδοση 1.10 τα μενού ορίζονται στο menus.json με ιεραρχία ρόλων.
Από την έκδοση 2.0 εμφανίζεται περιγραφή του μενού ανά ρόλο και προστέθηκε η οθόνη «Ορισμός σημείου ενδιαφέροντος» για τους διαχειριστές.
Από την έκδοση 2.1 οι διευθύνσεις των POI αποθηκεύονται και ομαδοποιημένες στο Firestore.
Από την έκδοση 2.2 ολοκληρώθηκε η επιλογή «Ορισμός σημείου ενδιαφέροντος» στο μενού του διαχειριστή.
Από την έκδοση 2.3 προστέθηκε η οθόνη «Επεξεργασία διαδρομής» για εισαγωγή πολλαπλών POI.
Από την έκδοση 2.4 ξεκίνησε η υλοποίηση της οθόνης «Δήλωση μεταφοράς».
Από την έκδοση 2.5 προστέθηκε ένδειξη προόδου στην οθόνη «Δήλωση μεταφοράς».
Για να λειτουργήσει ο χάρτης χρειάζεται να ορίσεις το Google Maps API key στο
`local.properties` της ρίζας του project:

```
MAPS_API_KEY=YOUR_API_KEY
```

Αντικατέστησε το `YOUR_API_KEY` με το πραγματικό κλειδί από το Google Cloud Console.

Το `app/build.gradle.kts` πλέον διαβάζει αυτόματα την τιμή από το `local.properties`,
οπότε αρκεί να προσθέσεις τη γραμμή με το κλειδί και να κάνεις "Sync Project" ή
"Rebuild" για να παραχθεί το `BuildConfig`.
Επιπλέον, φρόντισε να έχεις ενεργοποιήσει το **Maps SDK for Android** στο Google Cloud
και να μην περιορίζεται το κλειδί σε συγκεκριμένο package μέχρι να το προσθέσεις στο project.

Σε περιβάλλοντα CI μπορείς εναλλακτικά να ορίσεις τη μεταβλητή περιβάλλοντος
`MAPS_API_KEY` ώστε το Gradle script να χρησιμοποιήσει το κλειδί χωρίς να
απαιτείται αρχείο `local.properties`.

Μπορείς να επιβεβαιώσεις ότι το κλειδί φορτώθηκε σωστά προσθέτοντας στο κώδικα το παρακάτω απόσπασμα:

```kotlin
val apiKey = MapsUtils.getApiKey(context)
Log.d("Maps", "API key loaded? ${apiKey.isNotEmpty()}")
```

Έτσι θα δεις ένα μήνυμα στο log που επιβεβαιώνει ότι η εφαρμογή διαβάζει το κλειδί.

Αν αντιμετωπίσεις το σφάλμα **"Unresolved reference: BuildConfig"**, έλεγξε τα παρακάτω:

1. Σιγουρέψου ότι έχεις προσθέσει το import

   ```kotlin
   import com.ioannapergamali.mysmartroute.BuildConfig
   ```

   στην αρχή του αρχείου Kotlin όπου χρησιμοποιείς το `BuildConfig`.
2. Επιβεβαίωσε ότι στο `app/build.gradle.kts` είναι ενεργοποιημένο το `buildConfig`
   μέσω της επιλογής:

   ```kotlin
   buildFeatures {
       buildConfig = true
   }
   ```

3. Τέλος, κάνε "Sync Project with Gradle Files" ώστε να παραχθεί ξανά το αρχείο
   `BuildConfig`. Μετά την επιτυχημένη συγχρονίση, το σφάλμα θα εξαφανιστεί.

### Αν ο χάρτης δεν εμφανίζεται

Αν παρά τις παραπάνω ενέργειες το log γράφει `Maps API key loaded: false` και
βλέπεις στην οθόνη το μήνυμα «Google Maps API key is missing», δοκίμασε τα
εξής:

1. Βεβαιώσου ότι το `local.properties` βρίσκεται στον ίδιο φάκελο με τα
   `settings.gradle.kts` και `gradlew`.
2. Στο αρχείο να υπάρχει *μία* γραμμή της μορφής:

   ```
   MAPS_API_KEY=TO_DIKO_SOU_API_KEY
   ```

   χωρίς εισαγωγικά ή επιπλέον κενά.
3. Εκτέλεσε «Clean Project» και στη συνέχεια «Rebuild Project» για να παραχθεί
   ξανά το `BuildConfig` με το σωστό κλειδί.

### Αν δεις "Unresolved reference" για το Gson

Εάν η IDE εμφανίζει σφάλματα του τύπου *Unresolved reference: Gson* ή *TypeToken*, έλεγξε ότι στο αρχείο `app/build.gradle.kts` υπάρχει η γραμμή

```kotlin
implementation("com.google.code.gson:gson:2.13.1") // τελευταία διαθέσιμη έκδοση
```

Στη συνέχεια, στις κλάσεις Kotlin πρόσθεσε τα κατάλληλα imports:

```kotlin
import com.google.gson.Gson
import com.google.gson.reflect.TypeToken

private val gson = Gson()

// Μετατροπή JSON σε αντικείμενο Kotlin
val type = object : TypeToken<User>() {}.type
val user: User = gson.fromJson(jsonString, type)
```

Μετά την προσθήκη ή επιβεβαίωση της παραπάνω εξάρτησης, κάνε "Sync Project with Gradle Files" ώστε να κατέβει το library και να λυθούν τα σφάλματα.

### Αν τα κοντινά μέρη επιστρέφουν "null"

Οι λειτουργίες `fetchNearbyPlaceName` και `fetchNearbyPlaceType` χρησιμοποιούν το
Google Places API. Αν στο logcat βλέπεις μηνύματα όπως
`Nearby place name request failed: REQUEST_DENIED` ή οι τιμές
εμφανίζονται `null`, έλεγξε τα εξής:

1. Στη σελίδα Google Cloud Console πρέπει να είναι ενεργό το **Places API**.
2. Το API key δεν πρέπει να περιορίζεται σε λάθος SHA‑1 ή package name. Για δοκιμές
μπορείς προσωρινά να αφαιρέσεις όλους τους περιορισμούς.

Μετά τις αλλαγές κάνε επανεκκίνηση της εφαρμογής ώστε να χρησιμοποιήσει το σωστό κλειδί.


